#ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ú¯Ø±ÙØªÙ† Ø§Ø·Ù„Ø§Ø¹Ø§Øª 
                'Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ': full_name,
                'Ø¢ÛŒØ¯ÛŒ Ø¹Ø¯Ø¯ÛŒ': user.id,
                'ÛŒÙˆØ²Ø±Ù†ÛŒÙ…': u_name,
                'ÙˆØ¶Ø¹ÛŒØª': 'Ø¹Ø¶Ùˆ ÙØ¹Ù„ÛŒ'


import pandas as pd
from telethon.sync import TelegramClient
from telethon.tl.types import MessageService, MessageActionChatAddUser, MessageActionChatJoinedByLink, MessageActionChatDeleteUser

# --- Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒ Ø´Ù…Ø§ (Ø§Ø² my.telegram.org Ø¯Ø±ÛŒØ§ÙØª Ú©Ù†ÛŒØ¯) ---
api_id = ''          # Ø¢ÛŒØ¯ÛŒ Ø¹Ø¯Ø¯ÛŒ Ø´Ù…Ø§
api_hash = ''   # Ù‡Ø´ Ø§Ø®ØªØµØ§ØµÛŒ Ø´Ù…Ø§
# -------------------------------------------------------

# ÛŒÙˆØ²Ø±Ù†ÛŒÙ… ÛŒØ§ Ù„ÛŒÙ†Ú© Ú¯Ø±ÙˆÙ‡ (Ø¨Ø¯ÙˆÙ† @ ÛŒØ§ Ø¨Ø§ @ ÙØ±Ù‚ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯)
# Ù…Ø«Ø§Ù„: 'python_group' ÛŒØ§ 'https://t.me/example'
group_username = '' 

client = TelegramClient('my_session', api_id, 'api_hash')

async def main():
    await client.start()
    print("âœ… Ù…ØªØµÙ„ Ø´Ø¯. Ø¯Ø± Ø­Ø§Ù„ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù„ÛŒØ³Øª Ú©Ø§Ù…Ù„ Ø§Ø¹Ø¶Ø§...")

    all_members = []
    all_activities = []

    try:
        # Û±. Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù„ÛŒØ³Øª ØªÙ…Ø§Ù… Ø§Ø¹Ø¶Ø§ÛŒ ÙØ¹Ù„ÛŒ Ú¯Ø±ÙˆÙ‡ (Ø­ØªÛŒ Ø¨ÛŒ ØµØ¯Ø§Ù‡Ø§)
        async for user in client.iter_participants(group_username):
            f_name = user.first_name or ""
            l_name = user.last_name or ""
            full_name = f"{f_name} {l_name}".strip()
            u_name = f"@{user.username}" if user.username else "Ø¨Ø¯ÙˆÙ† ÛŒÙˆØ²Ø±Ù†ÛŒÙ…"
            
            all_members.append({
                'Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ': full_name,
                'Ø¢ÛŒØ¯ÛŒ Ø¹Ø¯Ø¯ÛŒ': user.id,
                'ÛŒÙˆØ²Ø±Ù†ÛŒÙ…': u_name,
                'ÙˆØ¶Ø¹ÛŒØª': 'Ø¹Ø¶Ùˆ ÙØ¹Ù„ÛŒ'
            })

        print(f"ğŸ‘¥ ØªØ¹Ø¯Ø§Ø¯ {len(all_members)} Ø¹Ø¶Ùˆ Ù¾ÛŒØ¯Ø§ Ø´Ø¯.")

        # Û². Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ Ùˆ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ ÙˆØ±ÙˆØ¯/Ø®Ø±ÙˆØ¬
        print("ğŸ“¥ Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ Ùˆ ØªØ§Ø±ÛŒØ®Ú†Ù‡ ÙˆØ±ÙˆØ¯ Ùˆ Ø®Ø±ÙˆØ¬...")
        async for message in client.iter_messages(group_username, limit=500):
            sender = await message.get_sender()
            
            if isinstance(message, MessageService):
                action = message.action
                msg_type = ""
                if isinstance(action, (MessageActionChatAddUser, MessageActionChatJoinedByLink)):
                    msg_type = "ğŸ“¥ ÙˆØ±ÙˆØ¯ Ø¬Ø¯ÛŒØ¯"
                elif isinstance(action, MessageActionChatDeleteUser):
                    msg_type = "ğŸ“¤ Ø®Ø±ÙˆØ¬/Ø­Ø°Ù"
                
                if msg_type:
                    f_name = getattr(sender, 'first_name', '') or ""
                    l_name = getattr(sender, 'last_name', '') or ""
                    all_activities.append({
                        'Ù†Ø§Ù…': f"{f_name} {l_name}".strip(),
                        'Ø¢ÛŒØ¯ÛŒ Ø¹Ø¯Ø¯ÛŒ': getattr(sender, 'id', 'N/A'),
                        'Ù†ÙˆØ¹ ÙØ¹Ø§Ù„ÛŒØª': msg_type,
                        'ØªØ§Ø±ÛŒØ®': message.date.strftime("%Y-%m-%d %H:%M")
                    })

        # Û³. Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Ø¯Ùˆ Ø´ÛŒØª Ù…Ø¬Ø²Ø§ Ø¯Ø± ÛŒÚ© ÙØ§ÛŒÙ„ Ø§Ú©Ø³Ù„
        with pd.ExcelWriter('telegram_full_report.xlsx') as writer:
            pd.DataFrame(all_members).to_excel(writer, sheet_name='Ù„ÛŒØ³Øª ØªÙ…Ø§Ù… Ø§Ø¹Ø¶Ø§', index=False)
            pd.DataFrame(all_activities).to_excel(writer, sheet_name='ØªØ§Ø±ÛŒØ®Ú†Ù‡ ÙˆØ±ÙˆØ¯ Ùˆ Ø®Ø±ÙˆØ¬', index=False)

        print("âœ¨ Ø¹Ù…Ù„ÛŒØ§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ØªÙ…Ø§Ù… Ø´Ø¯. ÙØ§ÛŒÙ„ 'telegram_full_report.xlsx' Ø±Ø§ Ø¨Ø§Ø² Ú©Ù†ÛŒØ¯.")
        print("ğŸ’¡ Ù†Ú©ØªÙ‡: Ù¾Ø§ÛŒÛŒÙ† ÙØ§ÛŒÙ„ Ø§Ú©Ø³Ù„ Ø¯Ùˆ ØªØ¨ (Sheet) ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯Ø› ÛŒÚ©ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø¹Ø¶Ø§ Ùˆ ÛŒÚ©ÛŒ Ø¨Ø±Ø§ÛŒ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§.")

    except Exception as e:
        print(f"âŒ Ø®Ø·Ø§: {e}")

with client:
    client.loop.run_until_complete(main())
